name: Restrict Merge to Admins

on:
  pull_request:
    branches:
      - main
    types: [opened, reopened, synchronize, ready_for_review]

jobs:
  restrict-merge:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    steps:
      - name: üîç Check if user is admin
        env:
          ACTOR: ${{ github.actor }}
          REPO: ${{ github.repository }}
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Checking if $ACTOR is an admin in $REPO"
          IS_ADMIN=$(curl -s -H "Authorization: token $TOKEN" \
            "https://api.github.com/repos/$REPO/collaborators/$ACTOR/permission" \
            | jq -r '.permission')

          echo "Permission level: $IS_ADMIN"

          if [ "$IS_ADMIN" != "admin" ]; then
            echo "‚ùå User '$ACTOR' is not an admin ‚Äî merge not allowed."
            exit 1
          else
            echo "‚úÖ User '$ACTOR' is an admin ‚Äî merge allowed."
          fi
