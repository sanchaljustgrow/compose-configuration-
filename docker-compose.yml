version: "3.8"

services:
  angular-frontend:
    image: sanchaljustgrow/docker-testnew-frontend:latest
    container_name: angular-frontend
    ports:
      - "8080:80"

    # Pick which config file to use by changing APP_ENV below üëá
    environment:
      APP_ENV: "dev" # choose dev | prod | staging | local

    volumes:
      - ./config:/app-config:ro

    command: >
      sh -c "
        echo 'üöÄ Starting container with APP_ENV=${APP_ENV}';
        CONFIG_FILE=/app-config/config.${APP_ENV}.json;
        TARGET=/usr/share/nginx/html/assets/config.json;

        if [ -f $CONFIG_FILE ]; then
          echo '‚úÖ Found config file:' $CONFIG_FILE;
          cp $CONFIG_FILE $TARGET;
        else
          echo '‚ö†Ô∏è No config file found for ${APP_ENV}, using default (config.dev.json)';
          cp /app-config/config.dev.json $TARGET;
        fi;

        echo 'üìÑ Final config.json content:';
        cat $TARGET;

        echo 'üöÄ Launching Nginx...';
        nginx -g 'daemon off;';
      "
